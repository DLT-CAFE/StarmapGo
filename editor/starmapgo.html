<!DOCTYPE html>
<html lang="en">

<head>
	<title>Starmap-M</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	<link rel="apple-touch-icon" href="images/icon.png">
	<link rel="manifest" href="manifest.json">
	<link rel="stylesheet" href="css/augmented-ui.min.css">
	<link rel="stylesheet" href="css/main.css">
	<link rel="stylesheet" href="css/starmap-go.css">
	<link rel="stylesheet" href="css/animate.css">
	<link rel="shortcut icon" href="../files/favicon_white.ico" media="(prefers-color-scheme: dark)" />
	<link rel="shortcut icon" href="../files/favicon.ico" media="(prefers-color-scheme: light)" />
	<link href="./styles/bootstrap/css/bootstrap.min.css" rel="stylesheet">


	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css"
		integrity="sha384-ejwKkLla8gPP8t2u0eQyL0Q/4ItcnyveF505U0NIobD/SMsNyXrLti6CWaD0L52l" crossorigin="anonymous">

	<link rel="stylesheet" href="js/libs/codemirror/codemirror.css">
	<link rel="stylesheet" href="js/libs/codemirror/theme/monokai.css">
	<link rel="stylesheet" href="js/libs/codemirror/addon/dialog.css">
	<link rel="stylesheet" href="js/libs/codemirror/addon/show-hint.css">
	<link rel="stylesheet" href="js/libs/codemirror/addon/tern.css">


</head>

<body>


	<!--------------------CODE FOR INITIAL PRE-LOADING SCREEEN Starts Here---------------------->
	<!-- <div id="preloader">
		<div class="text-center">
			<button type="button" class="btn btn-primary" onclick="OpenPopUpAndPlayAudio()">Start</button>
		</div>
		<div class="preloader-main d-flex align-items-center justify-content-center">
			<div class="preloader-1  animate__zoomIn">
				<div class="preloader-div">Loading</div>
				<span class="line line-1"></span>
				<span class="line line-2"></span>
				<span class="line line-3"></span>
				<span class="line line-4"></span>
				<span class="line line-5"></span>
				<span class="line line-6"></span>
				<span class="line line-7"></span>
				<span class="line line-8"></span>
				<span class="line line-9"></span>
			</div>



		</div>
	</div> -->


	<div id="preloader" class="preloader-1 preloader-div">
		<div class="preloader-div">Loading</div>
		<span class="line line-1"></span>
		<span class="line line-2"></span>
		<span class="line line-3"></span>
		<span class="line line-4"></span>
		<span class="line line-5"></span>
		<span class="line line-6"></span>
		<span class="line line-7"></span>
		<span class="line line-8"></span>
		<span class="line line-9"></span>

		<div>
			<button type="button" class="step2-startButton" onclick="OpenPopUpAndPlayAudio()">Start</button>
		</div>
	</div>


	<!----------------------CODE FOR INITIAL PRE-LOADING SCREEEN ENDS HERE---------------------->




	<script type="text/javascript">


		// this is for the audio play/ stop functionality button.
		var audioIsPlaying = true;
		//#region 


		function createAudioTag() {
			var x = document.createElement("AUDIO");
			x.setAttribute("id", "audioplay");
			if (x.canPlayType("audio/mpeg")) {
				x.setAttribute("src", "./audio/modal1.mp3");
			}
			x.setAttribute("hidden", "hidden");
			x.setAttribute("controls", "controls");
			if (audioIsPlaying) {
				x.setAttribute("autoplay", "autoplay");
			}
			x.setAttribute("loop", "loop");
			document.body.appendChild(x);

		}

		function playAudio() {
			if (document.getElementById('audioplay')) {
				if (!audioIsPlaying) {
					document.getElementById('audioplay').pause();
				} else {
					document.getElementById('audioplay').play();
				}
			}
		}

		function createAudioMuteButton() {
			let createSubmit = document.createElement("button");
			createSubmit.classList.add("btn");
			createSubmit.classList.add("btn-light");
			createSubmit.classList.add("audio-muteUnMute");
			createSubmit.innerText = audioIsPlaying ? "Mute" : "UnMute";
			createSubmit.addEventListener('click', () => {
				audioIsPlaying = !audioIsPlaying;
				createSubmit.innerText = audioIsPlaying ? "Mute" : "UnMute";
				playAudio();

			})


			document.body.appendChild(createSubmit);
		}


		//#region Play or Stop audio
		function OpenPopUpAndPlayAudio() {
			let getData = document.getElementById('preloader')
			if (getData) {
				getData.remove();
			}
			//#region Showing the First Bootstrap Modal on the Start
			var myModal = new bootstrap.Modal(document.getElementById('first-PopModal'), {
				keyboard: false
			})
			myModal.show();
			//#endregion
			createAudioTag();
			playAudio();


		}
		//#endregion
	</script>




	<script src="https://unpkg.com/@ffmpeg/ffmpeg@0.9.6/dist/ffmpeg.min.js" defer></script>

	<script src="../examples/js/libs/draco/draco_encoder.js"></script>
	<script src="./styles/bootstrap/js/bootstrap.min.js"></script>


	<script src="js/libs/codemirror/codemirror.js"></script>
	<script src="js/libs/codemirror/mode/javascript.js"></script>
	<script src="js/libs/codemirror/mode/glsl.js"></script>

	<script src="js/libs/esprima.js"></script>
	<script src="js/libs/jsonlint.js"></script>



	<script src="js/libs/codemirror/addon/dialog.js"></script>
	<script src="js/libs/codemirror/addon/show-hint.js"></script>
	<script src="js/libs/codemirror/addon/tern.js"></script>
	<script src="js/libs/acorn/acorn.js"></script>
	<script src="js/libs/acorn/acorn_loose.js"></script>
	<script src="js/libs/acorn/walk.js"></script>
	<script src="js/libs/ternjs/polyfill.js"></script>
	<script src="js/libs/ternjs/signal.js"></script>
	<script src="js/libs/ternjs/tern.js"></script>
	<script src="js/libs/ternjs/def.js"></script>
	<script src="js/libs/ternjs/comment.js"></script>
	<script src="js/libs/ternjs/infer.js"></script>
	<script src="js/libs/ternjs/doc_comment.js"></script>
	<script src="js/libs/tern-threejs/threejs.js"></script>
	<script src="js/libs/signals.min.js"></script>

	<!-- Import maps polyfill -->
	<!-- Remove this when import maps will be widely supported -->
	<script async src="https://unpkg.com/es-module-shims@1.3.6/dist/es-module-shims.js"></script>

	<script type="importmap">
			{
				"imports": {
					"three": "../build/three.module.js"
				}
			}
		</script>


	<script type="module">

		import * as THREE from 'three';
		import { Intro } from './js/Intro.js';
		import { Editor } from './js/Editor.js';
		import { Viewport } from './js/Viewport.js';
		import { Toolbar } from './js/Toolbar.js';
		import { Script } from './js/Script.js';
		import { Player } from './js/Player.js';
		import { Sidebar } from './js/Sidebar.js';
		import { Menubar } from './js/Menubar.js';
		import { Resizer } from './js/Resizer.js';
		import { VRButton } from '../examples/jsm/webxr/VRButton.js';
		import { BootstrapModal, UIDiv, UIButton } from './js/libs/ui.js';
		import { OrbitControls } from '../examples/jsm/controls/OrbitControls.js';
		import {iframeForPlayer} from './js/StarMap-Constant.js';


		window.URL = window.URL || window.webkitURL;
		window.BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder;

		Number.prototype.format = function () {

			return this.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1,');

		};

		//

		const editor = new Editor();

		window.editor = editor; // Expose editor to Console
		window.THREE = THREE; // Expose THREE to APP Scripts and Console
		window.VRButton = VRButton; // Expose VRButton to APP Scripts
		const signals = editor.signals;

		// const intro = new Intro( editor );
		// document.body.appendChild( intro.dom );

		signals.initializeStarMapGo.add(function () {

			intializeStartMapGoUI();

		});







		//#region First BootStrap Modal. 
		let bootstrapConfig = {
			bootstrapModalPopUpId: "first-PopModal",
			modalPopUpClassList: ["multiFormPopUp", "animate__animated", "animate__fadeIn", "bg-image"],
			//augmentedUiClass: "tl-clip br-clip both",
			modalDailogClassList: [],
			modalContentClassList: ["step1-content", "p-5", "pb-3"],

			modalBodyClassList: ["display-6", "animate__animated", "animate__fadeIn"],
			modalBodyContent: "In the begining, there was the great void. <br /> Then came the creation of our home, Gaiaplexa, and for the span of two cycles we sat alone in darkness and silence. Until one day, the first of the lights appeared in the night sky.",
			modalFooterClassList: ["border-0", "justify-content-center", "p-0"],
			modalFooterButtonClassList: ["step1-startButton", "animate__animated", "animate__fadeIn"],
			modalFooterButtonId: "first-popButton",
			nextPopUpId: "second-PopModal",
			footerButtonText: "-START-"
		}

		let bootstrapModal = new BootstrapModal(bootstrapConfig);
		document.body.appendChild(bootstrapModal['dom'].dom);

		bootstrapModal.bootstrapModalButton.onClick(res => {

		});


		//#endregion




		//bootstrapModal.bootstrapModalButton['dom'].click();

		//#region Second Bootstrap Modal Regio
		let bootstrapConfig1 = {
			bootstrapModalPopUpId: "second-PopModal",
			//augmentedUiClass: "tl-clip br-clip both",
			modalPopUpClassList: ["multiFormPopUp2", "animate__animated", "animate__fadeIn", "bg-image"],
			modalDailogClassList: [],
			modalContentClassList: ["step2-content", "p-5", "pb-3"],

			modalBodyClassList: ["display-6", "animate__animated", "animate__zoomIn"],
			modalBodyContent: "Seeking meaning to the phenomenon a noble Guild was formed, and the Starmap-M project was born. </br> The Guilds mission was to search, catalogue and connect every verse across the great void until there existed a single universal network of shared interoperable and persistent verses. </br>That would come to be known as THE METAVERSE ",
			modalFooterClassList: ["border-0", "justify-content-center", "p-0"],
			modalFooterButtonClassList: ["step2-startButton", "animate__animated", "animate__fadeIn"],
			modalFooterButtonId: "second-popButton",
			nextPopUpId: "third-PopModal",
			footerButtonText: "Continue"
		}

		let bootstrapModal1 = new BootstrapModal(bootstrapConfig1);
		bootstrapModal1.bootstrapModalButton.onClick(res => {

			let video = document.createElement("video");
			video.setAttribute("id", "bgVideo");
			video.setAttribute("loop", true);
			video.src = "images/video/spacemodal33.mp4";
			video.autoplay = true;

			video.controls = false;
			video.muted = true;
			video.classList.add("modal2-video");
			document.body.appendChild(video);

		});
		document.body.appendChild(bootstrapModal1['dom'].dom);
		//#endregion

		//#region Third Bootstrap Modal Region
		let bootstrapConfig2 = {

			addVideo: true,
			bootstrapModalPopUpId: "third-PopModal",
			modalPopUpClassList: ["animate__animated", "animate__fadeIn", "bg-image"],
			//augmentedUiClass: "tl-clip br-clip both",
			modalDailogClassList: [],
			modalContentClassList: ["step3-content", "p-5", "pb-3", "my-augborder"],

			modalBodyClassList: ["display-6", "text-light", "fw-bold", "modallogo", , "animate__animated", "animate__zoomIn"],
			modalBodyContent: "",
			modalFooterClassList: ["border-0", "justify-content-center", "p-0"],
			modalFooterButtonClassList: ["step3-startButton"],
			modalFooterButtonId: "third-popButton",
			footerButtonText: "Launch"

		}

		let bootstrapModal2 = new BootstrapModal(bootstrapConfig2);





		document.body.appendChild(bootstrapModal2['dom'].dom);
		//#endregion


		bootstrapModal2.bootstrapModalButton.onClick(res => {
			const element = document.getElementById('bgVideo');

			element.remove();
			init();
			//render(); // remove when using next line for animation loop (requestAnimationFrame)
			//animate();

			//intializeStartMapGoUI();
		})









		//#region  Initialize Editor For Three.js
		function intializeStartMapGoUI() {

			const viewport = new Viewport(editor);
			document.body.appendChild(viewport.dom);


			const toolbar = new Toolbar(editor);
			document.body.appendChild(toolbar.dom);
			let createSubmit = document.createElement("button");
			createSubmit.classList.add("btn");
			createSubmit.classList.add("btn-primary");
			createSubmit.classList.add("builder-button");
			createSubmit.innerText = "Back";
			createSubmit.addEventListener('click', () => {
				removeAllChildNotesOtherThanAudioFromBody();
				init();
				//animate();
				createAudioTag();
				playAudio();


			})


			document.body.appendChild(createSubmit);
			const script = new Script(editor);
			document.body.appendChild(script.dom);

			const player = new Player(editor);
			document.body.appendChild(player.dom);

			const sidebar = new Sidebar(editor);
			document.body.appendChild(sidebar.dom);

			const menubar = new Menubar(editor);

			let length = menubar.dom.children.length;
			//menubar.dom.children[length - 1].appendChild(createSubmit);
			document.body.appendChild(menubar.dom);




			//	document.body.appendChild(menubar.dom);

			const resizer = new Resizer(editor);
			document.body.appendChild(resizer.dom);

			//









			editor.storage.init(function () {

				editor.storage.get(function (state) {

					if (isLoadingFromHash) return;

					if (state !== undefined) {

						//	editor.fromJSON(state);

					}

					const selected = editor.config.getKey('selected');

					if (selected !== undefined) {

						editor.selectByUuid(selected);

					}

				});

				//

				let timeout;

				function saveState() {

					if (editor.config.getKey('autosave') === false) {

						return;

					}

					clearTimeout(timeout);

					timeout = setTimeout(function () {

						editor.signals.savingStarted.dispatch();

						timeout = setTimeout(function () {
							let editorJson = JSON.parse(JSON.stringify(editor.toJSON()));
							delete editorJson.scene;
							editor.storage.set(editorJson);

							editor.signals.savingFinished.dispatch();

						}, 100);

					}, 1000);

				}

				const signals = editor.signals;

				signals.geometryChanged.add(saveState);
				signals.objectAdded.add(saveState);
				signals.objectChanged.add(saveState);
				signals.objectRemoved.add(saveState);
				signals.materialChanged.add(saveState);
				signals.sceneBackgroundChanged.add(saveState);
				signals.sceneEnvironmentChanged.add(saveState);
				signals.sceneFogChanged.add(saveState);
				signals.sceneGraphChanged.add(saveState);
				signals.scriptChanged.add(saveState);
				signals.historyChanged.add(saveState);

			});

			//

			document.addEventListener('dragover', function (event) {

				event.preventDefault();
				event.dataTransfer.dropEffect = 'copy';

			});

			document.addEventListener('drop', function (event) {

				event.preventDefault();

				if (event.dataTransfer.types[0] === 'text/plain') return; // Outliner drop

				if (event.dataTransfer.items) {

					// DataTransferItemList supports folders

					editor.loader.loadItemList(event.dataTransfer.items);

				} else {

					editor.loader.loadFiles(event.dataTransfer.files);

				}

			});

			function onWindowResize() {

				editor.signals.windowResize.dispatch();

			}

			window.addEventListener('resize', onWindowResize);

			onWindowResize();

			//

			let isLoadingFromHash = false;
			const hash = window.location.hash;

			if (hash.slice(1, 6) === 'file=') {

				const file = hash.slice(6);

				if (confirm('Any unsaved data will be lost. Are you sure?')) {

					const loader = new THREE.FileLoader();
					loader.crossOrigin = '';
					loader.load(file, function (text) {

						editor.clear();
						editor.fromJSON(JSON.parse(text));

					});

					isLoadingFromHash = true;

				}

			}

			// ServiceWorker

			if ('serviceWorker' in navigator) {

				try {

					navigator.serviceWorker.register('sw.js');

				} catch (error) {

				}

			}

		}
		//#endregion





		let camera, controls, scene, renderer;

function createIframeForOrbitControl(){
		var ifrm = document.createElement('iframe');
		ifrm.setAttribute('id', 'ifrm'); // assign an id
		ifrm.classList.add("w-100");
		ifrm.style.height = "1000px";
		document.body.appendChild(ifrm); // to place at end of document
		ifrm.setAttribute('src', iframeForPlayer);
}



		function init() {
			const menubar = new Menubar(editor);
			createAudioMuteButton();
			let createSubmit = document.createElement("button");
			createSubmit.classList.add("btn");
			createSubmit.classList.add("btn-primary");
			createSubmit.classList.add("builder-button");
			createSubmit.innerText = "Builder";
			createSubmit.addEventListener('click', () => {
				removeAllChildNotesOtherThanAudioFromBody();

				intializeStartMapGoUI();
				createAudioTag();
				playAudio();
				createAudioMuteButton();
			})
			let length = menubar.dom.children.length;
			menubar.dom.children[1].style.display = "none";

			menubar.dom.children[2].innerText = "";

			//menubar.dom.children[length - 1].appendChild(createSubmit);
			document.body.appendChild(menubar.dom);
			document.body.appendChild(createSubmit);
			createIframeForOrbitControl();
			// scene = new THREE.Scene();
			// scene.background = new THREE.Color(0xcccccc);
			// scene.fog = new THREE.FogExp2(0xcccccc, 0.002);

			// renderer = new THREE.WebGLRenderer({ antialias: true });
			// renderer.setPixelRatio(window.devicePixelRatio);
			// renderer.setSize(window.innerWidth, window.innerHeight);
			// document.body.appendChild(renderer.domElement);

			// camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 1, 1000);
			// camera.position.set(400, 200, 0);

			// // controls

			// controls = new OrbitControls(camera, renderer.domElement);
			// controls.listenToKeyEvents(window); // optional

			// //controls.addEventListener( 'change', render ); // call this only in static scenes (i.e., if there is no animation loop)

			// controls.enableDamping = true; // an animation loop is required when either damping or auto-rotation are enabled
			// controls.dampingFactor = 0.05;

			// controls.screenSpacePanning = false;

			// controls.minDistance = 100;
			// controls.maxDistance = 500;

			// controls.maxPolarAngle = Math.PI / 2;

			// // world

			// const geometry = new THREE.CylinderGeometry(0, 10, 30, 4, 1);
			// const material = new THREE.MeshPhongMaterial({ color: 0xffffff, flatShading: true });

			// for (let i = 0; i < 500; i++) {

			// 	const mesh = new THREE.Mesh(geometry, material);
			// 	mesh.position.x = Math.random() * 1600 - 800;
			// 	mesh.position.y = 0;
			// 	mesh.position.z = Math.random() * 1600 - 800;
			// 	mesh.updateMatrix();
			// 	mesh.matrixAutoUpdate = false;
			// 	scene.add(mesh);

			// }

			// // lights

			// const dirLight1 = new THREE.DirectionalLight(0xffffff);
			// dirLight1.position.set(1, 1, 1);
			// scene.add(dirLight1);

			// const dirLight2 = new THREE.DirectionalLight(0x002288);
			// dirLight2.position.set(- 1, - 1, - 1);
			// scene.add(dirLight2);

			// const ambientLight = new THREE.AmbientLight(0x222222);
			// scene.add(ambientLight);

			//

		//	window.addEventListener('resize', onWindowResize);

		}

		function onWindowResize() {

			camera.aspect = window.innerWidth / window.innerHeight;
			camera.updateProjectionMatrix();

			renderer.setSize(window.innerWidth, window.innerHeight);

		}

		function animate() {

			requestAnimationFrame(animate);

			controls.update(); // only required if controls.enableDamping = true, or if controls.autoRotate = true

			render();

		}

		function render() {

			renderer.render(scene, camera);

		}


		function removeAllChildNotesOtherThanAudioFromBody() {
			let list = document.getElementsByTagName("body")[0];


			// debugger;
			// for(let i=0;i<list.children.length;i++){
			// 	let nodeInfo = list.children[i];
			// 	if(nodeInfo.id !== 'audioplay'){
			//           nodeInfo.remove();
			// 	}

			// }
			// As long as <ul> has a child node, remove it
			while (list.hasChildNodes()) {

				// if(list.firstChild.id !== 'audioplay'){
				list.removeChild(list.firstChild);
				// }
			}
		}






	</script>
</body>

</html>